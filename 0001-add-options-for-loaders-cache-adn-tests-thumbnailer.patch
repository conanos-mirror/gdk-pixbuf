From c3419cc38fc8d7975864db314a1032ba240de788 Mon Sep 17 00:00:00 2001
From: cppbitman <daihongjun@kedacom.com>
Date: Wed, 19 Dec 2018 01:06:40 -0800
Subject: [PATCH] add options for loaders-cache adn tests-thumbnailer

---
 gdk-pixbuf/meson.build | 26 ++++++++++++++------------
 meson.build            |  6 ++++--
 meson_options.txt      |  9 ++++++++-
 3 files changed, 26 insertions(+), 15 deletions(-)

diff --git a/gdk-pixbuf/meson.build b/gdk-pixbuf/meson.build
index bcfe581b6..8aef5e94a 100644
--- a/gdk-pixbuf/meson.build
+++ b/gdk-pixbuf/meson.build
@@ -311,18 +311,20 @@ foreach bin: gdkpixbuf_bin
 endforeach
 
 if not meson.is_cross_build()
-  # The 'loaders.cache' used for testing, so we don't accidentally
-  # load the installed cache; we always build it by default
-  loaders_cache = custom_target('loaders.cache',
-                                output: 'loaders.cache',
-                                capture: true,
-                                command: [
-                                  gdk_pixbuf_query_loaders,
-                                  dynamic_loaders,
-                                ],
-                                depends: dynamic_loaders_dep,
-                                build_by_default: true)
-  loaders_dep = declare_dependency(sources: [ loaders_cache ])
+  if get_option('build_loaders_cache')
+    # The 'loaders.cache' used for testing, so we don't accidentally
+    # load the installed cache; we always build it by default
+    loaders_cache = custom_target('loaders.cache',
+                                  output: 'loaders.cache',
+                                  capture: true,
+                                  command: [
+                                    gdk_pixbuf_query_loaders,
+                                    dynamic_loaders,
+                                  ],
+                                  depends: dynamic_loaders_dep,
+                                  build_by_default: true)
+    loaders_dep = declare_dependency(sources: [ loaders_cache ])
+  endif
 else
   loaders_cache = []
   loaders_dep = declare_dependency()
diff --git a/meson.build b/meson.build
index d70ccf8d0..34fcb3fd7 100644
--- a/meson.build
+++ b/meson.build
@@ -398,8 +398,10 @@ endif
 subdir('po')
 
 if not meson.is_cross_build()
-  subdir('tests')
-  subdir('thumbnailer')
+  if get_option('build_tests_and_thumbnailer')
+    subdir('tests')
+    subdir('thumbnailer')
+  endif
 endif
 
 # Documentation
diff --git a/meson_options.txt b/meson_options.txt
index a7c33a869..2b1f0946a 100644
--- a/meson_options.txt
+++ b/meson_options.txt
@@ -50,4 +50,11 @@ option('gio_sniffing',
        description: 'Perform file type detection using GIO (Unused on MacOS and Windows)',
        type: 'boolean',
        value: true)
-
+option('build_loaders_cache',
+       description: 'Build loaders-cache',
+       type: 'boolean',
+       value: true)
+option('build_tests_and_thumbnailer',
+       description: 'Build tests and thumbnailer',
+       type: 'boolean',
+       value: true)
\ No newline at end of file
-- 
2.17.1

